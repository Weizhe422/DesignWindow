# DesignWindow 功能說明文件

## 概述
本文檔詳細說明 DesignWindow 應用程式中最近實作的三個核心功能：**儲存 (Save)**、**另存新檔 (Save As)** 以及 **文字編輯器 (Text Editor)**。

---

## 一、儲存功能 (Save Function)

### 1.1 功能位置
- **檔案選單**：檔案(E) → 儲存(S)
- **工具列**：儲存按鈕（磁碟圖示）
- **快捷鍵**：`Ctrl+S`

### 1.2 程式碼實作
```cpp
void MainWindow::onSaveTriggered()
{
    if (currentFilePath.isEmpty()) {
        // 如果沒有當前檔案路徑，則呼叫另存為
        onSaveAsTriggered();
    } else {
        // 儲存到當前檔案
        saveToFile(currentFilePath);
    }
}
```

### 1.3 功能說明
**儲存功能**是一個智慧型的檔案保存機制，其運作邏輯如下：

1. **檢查當前檔案路徑**：
   - 程式會先檢查 `currentFilePath` 成員變數
   - 此變數儲存當前正在編輯的檔案路徑

2. **智慧判斷**：
   - **情況A - 首次儲存**：如果 `currentFilePath` 為空（表示是新建文件或尚未儲存過），則自動觸發「另存新檔」對話框
   - **情況B - 已有檔案**：如果已經有檔案路徑，則直接覆蓋儲存到該檔案

3. **使用時機**：
   - 快速儲存已開啟的文件
   - 不需要重新選擇儲存位置
   - 適合頻繁保存工作進度

### 1.4 設計優點
- **智慧化**：自動判斷是否需要顯示檔案選擇對話框
- **效率高**：已存檔的文件可快速覆蓋儲存
- **使用者友善**：符合一般文字編輯器的使用習慣

---

## 二、另存新檔功能 (Save As Function)

### 2.1 功能位置
- **檔案選單**：檔案(E) → 另存(A)
- **工具列**：另存按鈕（磁碟圖示變體）

### 2.2 程式碼實作
```cpp
void MainWindow::onSaveAsTriggered()
{
    QString fileName = QFileDialog::getSaveFileName(
        this,
        tr("另存檔案"),
        "",
        tr("文字檔案 (*.txt);;所有檔案 (*.*)")
    );
    
    if (!fileName.isEmpty()) {
        saveToFile(fileName);
        currentFilePath = fileName;
    }
}
```

### 2.3 功能說明
**另存新檔功能**提供完整的檔案儲存對話框，讓使用者可以：

1. **開啟檔案選擇對話框**：
   - 使用 Qt 的 `QFileDialog::getSaveFileName()` 方法
   - 對話框標題顯示「另存檔案」

2. **選擇儲存位置和檔名**：
   - 使用者可以瀏覽檔案系統
   - 自由輸入新的檔案名稱
   - 選擇儲存的目錄位置

3. **檔案類型篩選**：
   - 提供兩種檔案類型選項：
     - `文字檔案 (*.txt)`：預設選項，適合文字內容
     - `所有檔案 (*.*)`：允許使用任意副檔名

4. **儲存並更新路徑**：
   - 如果使用者確認儲存（沒有取消），則：
     - 呼叫 `saveToFile()` 執行實際儲存
     - 更新 `currentFilePath` 為新的檔案路徑

### 2.4 使用時機
- 將文件儲存為新檔案
- 在不同位置建立文件副本
- 以不同檔名儲存文件
- 首次儲存新建立的文件

### 2.5 設計優點
- **靈活性**：可自由選擇儲存位置和檔名
- **安全性**：不會覆蓋原始檔案（除非使用者主動選擇）
- **檔案類型支援**：支援多種檔案格式

---

## 三、共用儲存機制 (Shared Save Mechanism)

### 3.1 核心儲存函式
```cpp
void MainWindow::saveToFile(const QString &filePath)
{
    QFile file(filePath);
    if (!file.open(QIODevice::WriteOnly | QIODevice::Text)) {
        QMessageBox::warning(this, tr("儲存錯誤"), 
                           tr("無法儲存檔案: %1").arg(file.errorString()));
        return;
    }
    
    QTextStream out(&file);
    out << textEdit->toPlainText();
    
    statusbar->showMessage(tr("檔案已儲存: %1").arg(filePath), 3000);
}
```

### 3.2 功能說明
**saveToFile()** 是 Save 和 Save As 共用的底層儲存函式：

1. **開啟檔案**：
   - 創建 `QFile` 物件
   - 使用 `QIODevice::WriteOnly` 模式（只寫）
   - 使用 `QIODevice::Text` 模式（文字模式）

2. **錯誤處理**：
   - 如果無法開啟檔案（權限不足、路徑不存在等）
   - 顯示警告對話框，說明錯誤原因
   - 使用 `file.errorString()` 取得系統錯誤訊息

3. **寫入內容**：
   - 使用 `QTextStream` 進行文字串流寫入
   - 從 `textEdit` 控件取得純文字內容（`toPlainText()`）
   - 將內容寫入檔案

4. **使用者回饋**：
   - 在狀態列顯示成功訊息
   - 顯示實際儲存的檔案路徑
   - 訊息顯示 3 秒後自動消失

### 3.3 設計優點
- **程式碼重用**：兩個功能共用同一個儲存邏輯
- **完善的錯誤處理**：能妥善處理各種儲存失敗情況
- **使用者回饋**：透過狀態列即時告知操作結果

---

## 四、文字編輯器功能 (Text Editor Feature)

### 4.1 控件資訊
- **控件類型**：`QTextEdit`
- **變數名稱**：`textEdit`
- **位置**：主視窗中央區域

### 4.2 程式碼實作
```cpp
// 文字編輯器暗黑風格
QString textEditStyle = R"(
    QTextEdit {
        background-color: #1e1e1e;
        color: #e0e0e0;
        border: 1px solid #3d3d3d;
        selection-background-color: #404040;
        selection-color: #ffffff;
        font-family: "Consolas", "Monaco", "Courier New", monospace;
    }
)";

textEdit->setStyleSheet(textEditStyle);
```

### 4.3 功能說明
**文字編輯器**是主要的內容編輯區域，提供以下功能：

1. **基本編輯功能**：
   - 文字輸入和編輯
   - 支援多行文字
   - 支援換行和格式化

2. **外觀設計 - 暗黑主題**：
   - **背景色**：`#1e1e1e` （深灰黑色）
   - **文字色**：`#e0e0e0` （淺灰白色）
   - **邊框色**：`#3d3d3d` （中灰色，1px 實線）
   - **選取背景**：`#404040` （中深灰色）
   - **選取文字**：`#ffffff` （純白色）

3. **字體設定**：
   - 使用等寬字體（monospace）
   - 優先順序：Consolas → Monaco → Courier New
   - 適合程式碼和文字編輯

4. **與儲存功能的整合**：
   - 透過 `textEdit->toPlainText()` 取得內容
   - 將編輯器的內容轉換為純文字格式
   - 儲存到檔案

### 4.4 使用者體驗特點
- **護眼設計**：暗黑主題減少眼睛疲勞
- **對比清晰**：文字與背景有足夠對比度
- **專業外觀**：等寬字體適合編輯結構化內容
- **視覺一致性**：與整體應用程式的暗黑風格統一

---

## 五、UI 元素定義 (UI Elements)

### 5.1 選單結構（ui_mainwindow.ui）

#### 檔案選單
```xml
<widget class="QMenu" name="menu_E">
    <property name="title">
        <string>檔案(E)</string>
    </property>
    <addaction name="action_S"/>     <!-- 儲存 -->
    <addaction name="action_A"/>     <!-- 另存 -->
</widget>
```

#### 儲存動作（Action）
```xml
<action name="action_S">
    <property name="icon">
        <iconset resource="images/images/designwindow.qrc">
            <normaloff>:/images/save.png</normaloff>
        </iconset>
    </property>
    <property name="text">
        <string>儲存(S)</string>
    </property>
    <property name="shortcut">
        <string>Ctrl+S</string>
    </property>
</action>

<action name="action_A">
    <property name="icon">
        <iconset resource="images/images/designwindow.qrc">
            <normaloff>:/images/asave.png</normaloff>
        </iconset>
    </property>
    <property name="text">
        <string>另存(A)</string>
    </property>
</action>
```

### 5.2 訊號與槽連接（mainwindow.cpp）
```cpp
// 連接 Save 和 Save As 動作
connect(action_S, &QAction::triggered, this, &MainWindow::onSaveTriggered);
connect(action_A, &QAction::triggered, this, &MainWindow::onSaveAsTriggered);
```

**說明**：
- `action_S` 觸發時，呼叫 `onSaveTriggered()` 槽函式
- `action_A` 觸發時，呼叫 `onSaveAsTriggered()` 槽函式
- 使用 Qt 的訊號槽機制實現事件處理

---

## 六、資料成員 (Data Members)

### 6.1 主視窗類別定義（mainwindow.h）
```cpp
class MainWindow : public QMainWindow, public Ui_MainWindow
{
    Q_OBJECT

public:
    MainWindow(QWidget *parent = nullptr);
    ~MainWindow();

private slots:
    void onSaveTriggered();      // 儲存槽函式
    void onSaveAsTriggered();    // 另存為槽函式

private:
    QString currentFilePath;     // 當前檔案路徑
    void saveToFile(const QString &filePath);  // 儲存函式
};
```

### 6.2 成員說明

#### `currentFilePath` (QString)
- **用途**：儲存當前正在編輯的檔案完整路徑
- **初始值**：空字串（新建文件）
- **更新時機**：
  - Save As 執行後更新為新檔案路徑
  - 開啟檔案後更新為開啟的檔案路徑
- **作用**：
  - 判斷是否需要顯示 Save As 對話框
  - 提供快速儲存的目標路徑
  - 在狀態列顯示當前檔案資訊

---

## 七、視覺風格系統 (Visual Style System)

### 7.1 暗黑主題設計理念
整個應用程式採用一致的暗黑主題，提供：
- **減少眼睛疲勞**：適合長時間使用
- **專業外觀**：類似現代 IDE 和編輯器
- **視覺協調**：所有元件使用統一配色方案

### 7.2 配色方案
```cpp
// 主要顏色定義
#1e1e1e  // 主背景色（深灰黑）
#2d2d2d  // 選單背景色（中深灰）
#3d3d3d  // 邊框和分隔線色（中灰）
#404040  // 選取背景色（中亮灰）
#e0e0e0  // 主文字色（淺灰白）
#ffffff  // 高亮文字色（純白）
```

### 7.3 應用範圍
- **主視窗背景**：#1e1e1e
- **選單列**：漸層背景（#2d2d2d 到 #1a1a1a）
- **文字編輯器**：#1e1e1e 背景，#e0e0e0 文字
- **狀態列**：#2d2d2d 背景，#3d3d3d 上邊框

---

## 八、技術特點總結

### 8.1 使用的 Qt 類別
1. **QFileDialog**：提供檔案選擇對話框
2. **QFile**：處理檔案讀寫操作
3. **QTextStream**：文字串流處理
4. **QMessageBox**：顯示錯誤和警告訊息
5. **QTextEdit**：多行文字編輯控件
6. **QAction**：選單和工具列動作
7. **QStatusBar**：狀態列顯示訊息

### 8.2 設計模式
- **訊號與槽機制**：實現解耦的事件處理
- **共用函式設計**：`saveToFile()` 被多個功能重用
- **智慧判斷邏輯**：Save 功能自動判斷應執行的操作

### 8.3 錯誤處理
- 檔案開啟失敗時顯示錯誤訊息
- 提供具體的錯誤原因說明
- 防止程式崩潰

### 8.4 使用者體驗
- 即時狀態回饋（狀態列訊息）
- 標準快捷鍵支援（Ctrl+S）
- 符合主流編輯器的操作習慣
- 視覺一致性（暗黑主題）

---

## 九、使用流程範例

### 範例 1：首次儲存新文件
1. 使用者在 `textEdit` 輸入內容
2. 按下 `Ctrl+S` 或點擊儲存按鈕
3. 因為 `currentFilePath` 為空，自動觸發另存新檔對話框
4. 使用者選擇儲存位置和檔名（例如：`C:\Documents\my_file.txt`）
5. 程式將文字內容寫入檔案
6. `currentFilePath` 更新為 `C:\Documents\my_file.txt`
7. 狀態列顯示「檔案已儲存: C:\Documents\my_file.txt」

### 範例 2：編輯現有文件後儲存
1. 使用者修改已開啟的文件內容
2. 按下 `Ctrl+S`
3. 因為 `currentFilePath` 已有值，直接覆蓋儲存
4. 無需重新選擇檔案
5. 狀態列顯示確認訊息

### 範例 3：另存為新檔案
1. 使用者編輯文件後想保留原始檔案
2. 點擊「檔案」→「另存(A)」
3. 在對話框中輸入新檔名（例如：`my_file_v2.txt`）
4. 程式將內容儲存到新檔案
5. `currentFilePath` 更新為新檔案路徑
6. 之後的 Save 操作將儲存到新檔案

---

## 十、未來可能的擴展

### 10.1 建議的功能增強
1. **自動儲存**：定時自動儲存功能
2. **儲存前確認**：檔案已修改時詢問是否儲存
3. **最近使用檔案**：記錄最近開啟的檔案列表
4. **檔案變更偵測**：偵測檔案是否被外部程式修改
5. **編碼選擇**：支援不同的文字編碼（UTF-8、Big5 等）

### 10.2 潛在的改進
1. **復原/重做**：整合更完善的編輯歷史管理
2. **多檔案支援**：分頁式編輯多個文件
3. **語法高亮**：根據檔案類型提供語法著色

---

## 結語

本程式碼實作了一個功能完整、使用者友善的文字編輯和檔案儲存系統。透過 **Save**、**Save As** 和 **Text Editor** 三個核心功能的緊密整合，提供了類似專業文字編輯器的使用體驗。

**主要優勢**：
- ✅ 智慧化的儲存邏輯
- ✅ 完善的錯誤處理
- ✅ 統一的暗黑視覺風格
- ✅ 符合使用者直覺的操作方式
- ✅ 良好的程式碼組織結構

這些功能為 DesignWindow 應用程式建立了堅實的基礎，使其能夠作為一個實用的文字編輯工具使用。
